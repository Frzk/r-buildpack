#!/usr/bin/env bash

set -eo pipefail

if [ -n "${BUILDPACK_DEBUG}" ]
then
    set -x
fi

readonly build_dir="${1}"
readonly cache_dir="${2}"
readonly env_dir="${3}"

readonly base_dir="$( cd -P "$( dirname "$0" )" && pwd )"
readonly buildpack_dir="$( readlink -f "${base_dir}/.." )"


readonly url="https://cran.r-project.org/src/base/R-4/R-4.0.0.tar.gz"


curl -L "${url}" --output "${cache_dir}/R-4.0.0.tar.gz"

tar -xvzf "${cache_dir}/R-4.0.0.tar/gz"

pushd "${cache_dir}/R-4.0.0"
./configure --prefix="${build_dir}/R-4.0.0" \
            --enable-java=no \
            --with-recommended-packages=no
make
make install
popd

ln -sfn "${build_dir}/R-4.0.0" "${build_dir}/R"

export PATH="${build_dir}/R/bin:${PATH}"

echo "Done."
